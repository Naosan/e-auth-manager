# e-auth-manager - Environment Configuration Example
# Copy this file to .env (in your app project root). The library loads .env from the current working directory first, then falls back to the package root.
# Alternatively, set EAUTH_CONFIG to a JSON config file (see README) and keep .env minimal.

# API Credentials (REQUIRED)
# Preferred names (provider-agnostic)
EAUTH_CLIENT_ID=your_client_id
EAUTH_CLIENT_SECRET=your_client_secret
# Explicit eBay prefix aliases (if you want to be clear it's for eBay keys)
# EAUTH_EBAY_CLIENT_ID=your_ebay_client_id
# EAUTH_EBAY_CLIENT_SECRET=your_ebay_client_secret
# Backward-compatible aliases
# EBAY_CLIENT_ID=your_ebay_client_id
# EBAY_CLIENT_SECRET=your_ebay_client_secret
# EBAY_API_APP_NAME=your_legacy_app_name
# EBAY_API_CERT_NAME=your_legacy_cert_name

# eBay API Environment
EAUTH_ENVIRONMENT=PRODUCTION
# EAUTH_ENVIRONMENT=SANDBOX
# EBAY_ENVIRONMENT=PRODUCTION
# EBAY_ENVIRONMENT=SANDBOX

# Optional JSON config file (can include clientId/secret, masterKey, paths, etc.)
EAUTH_CONFIG=

# Security Configuration (optional)
# By default the library uses the machine hostname as the encryption key.
# Leave this unset to derive a per-machine key from the current hostname.
# Set it only when you need to share encrypted tokens across hosts or rotate keys manually.
# Required when using OAUTH_SSOT_JSON so every instance can decrypt the shared file.
# Generate a secure key: openssl rand -hex 32
# If you change this value later, the library refuses to purge tokens by default and throws EAUTH_ENCRYPTION_KEY_MISMATCH.
# To purge tokens explicitly on key change (DESTRUCTIVE), set:
# EAUTH_PURGE_ON_KEY_CHANGE=1
# Legacy note: very old versions derived the token-file key from masterKey + COMPUTERNAME/HOSTNAME.
# If you need to decrypt a legacy token file, set EAUTH_MACHINE_ID (or COMPUTERNAME/HOSTNAME) to the original value and run an explicit migration.
# For manual cleanup or incident response, run: node examples/reset-encryption.js
EAUTH_MASTER_KEY=your_secure_master_key_change_me_in_production
# EBAY_OAUTH_TOKEN_MANAGER_MASTER_KEY=your_secure_master_key_change_me_in_production  # deprecated; use EAUTH_MASTER_KEY

# Initial Refresh Token for First-Time Setup (IMPORTANT)
# This token MUST be obtained manually through eBay's browser-based OAuth flow
# It cannot be generated via API
# 
# When this environment variable is set:
# 1. The token will be automatically initialized on first startup
# 2. It will be encrypted and saved to:
#    - SQLite database: ./database/ebay_tokens.sqlite
#    - Encrypted JSON file (platform-specific):
#      Windows: %LOCALAPPDATA%\ebay-oauth-tokens\ebay-tokens.encrypted.json
#      macOS: ~/Library/Application Support/ebay-oauth-tokens/
#      Linux: ~/.local/share/ebay-oauth-tokens/
# 3. The library will automatically use this token to obtain access tokens
#
# Note: This is a one-time setup. Once saved, the token persists and this
# environment variable is no longer needed
# It seeds only the default account (EAUTH_ACCOUNT_NAME / EBAY_ACCOUNT_NAME; default: "default") with EBAY_DEFAULT_APP_ID (single-account use).
EAUTH_INITIAL_REFRESH_TOKEN=your_manual_refresh_token_from_browser_oauth
# EBAY_INITIAL_REFRESH_TOKEN=your_manual_refresh_token_from_browser_oauth  # deprecated; use EAUTH_INITIAL_REFRESH_TOKEN

# Auto-seeding mode when EAUTH_INITIAL_REFRESH_TOKEN is present (optional)
# - auto (default): seed only when DB has no token or the stored refresh token is expired
# - sync: overwrite when different (DANGEROUS; use only if env is the source of truth)
EAUTH_INITIAL_REFRESH_TOKEN_MODE=auto
# EAUTH_INITIAL_REFRESH_TOKEN_MODE=sync

# Optional account name (used for SQLite `account_name` in seeding + legacy accountName APIs)
EAUTH_ACCOUNT_NAME=default
# EBAY_ACCOUNT_NAME=default

# Centralized JSON (SSOT) Configuration
# Path to centralized JSON file for shared refresh token storage
EAUTH_SSOT_JSON=/var/secure/ebay/refresh-ssot.json
OAUTH_SSOT_JSON=/var/secure/ebay/refresh-ssot.json
# Namespace for token organization (optional)
EAUTH_TOKEN_NAMESPACE=ebay-oauth
TOKEN_NAMESPACE=ebay-oauth

# Database Configuration
# Default: ./database/ebay_tokens.sqlite
# Tip: In production (or when used from other repos), prefer an absolute path to avoid CWD-related empty DB issues.
# If multiple apps/services should share tokens, point them all to the same absolute DB path (and use the same master key).
# Recommended absolute locations (examples):
# - Linux:   /home/you/.local/share/e-auth-manager/ebay_tokens.sqlite  (or $XDG_DATA_HOME/e-auth-manager/ebay_tokens.sqlite)
# - macOS:   /Users/you/Library/Application Support/e-auth-manager/ebay_tokens.sqlite
# - Windows: C:\\Users\\you\\AppData\\Local\\e-auth-manager\\ebay_tokens.sqlite
# - Server:  /var/lib/e-auth-manager/ebay_tokens.sqlite
EAUTH_DATABASE_PATH=./database/ebay_tokens.sqlite
# EBAY_DATABASE_PATH=./database/ebay_tokens.sqlite

# File Storage Configuration
# For custom token file location (leave empty to use OS-specific default location)
EAUTH_TOKEN_FILE_PATH=
# EBAY_TOKEN_FILE_PATH=

# Token file recovery behavior when the encrypted JSON cache is unreadable (optional)
# - error (default): do not modify the file; throw EAUTH_TOKEN_FILE_UNREADABLE (manager may still fall back to DB)
# - backup-and-reset: rename to *.backup.* and reset to empty storage
EAUTH_TOKEN_FILE_RECOVERY_MODE=error
# EAUTH_TOKEN_FILE_RECOVERY_MODE=backup-and-reset

# Advanced Configuration (rarely needs to be changed)
EAUTH_TOKEN_URL=https://api.ebay.com/identity/v1/oauth2/token
EAUTH_SCOPE=https://api.ebay.com/oauth/api_scope
# EBAY_TOKEN_URL=https://api.ebay.com/identity/v1/oauth2/token
# EBAY_SCOPE=https://api.ebay.com/oauth/api_scope
